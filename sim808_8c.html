<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>GPS tracker code documentation: sim808.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">GPS tracker code documentation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">sim808.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implementations of functions that communicate directly with the SIM808 module and control it.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="sim808_8h_source.html">sim808.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a84820ae6c2b7143c1692312a0e3d7069"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim808_8c.html#a84820ae6c2b7143c1692312a0e3d7069">AT_uart</a>&#160;&#160;&#160;<a class="el" href="sim808_8c.html#a2cf715bef37f7e8ef385a30974a5f0d5">huart1</a></td></tr>
<tr class="separator:a84820ae6c2b7143c1692312a0e3d7069"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e23ff1d2d0704f67d286589f8de591a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim808_8c.html#a2e23ff1d2d0704f67d286589f8de591a">debug_uart</a>&#160;&#160;&#160;<a class="el" href="sim808_8c.html#aa9479c261d65eecedd3d9582f7f0f89c">huart2</a></td></tr>
<tr class="separator:a2e23ff1d2d0704f67d286589f8de591a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6e14828149893fb70f1cee3155436042"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim808_8c.html#a6e14828149893fb70f1cee3155436042">send_debug</a> (const char *debug_msg)</td></tr>
<tr class="separator:a6e14828149893fb70f1cee3155436042"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14a3978f311f3f3fca3c0f44b2c55246"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim808_8c.html#a14a3978f311f3f3fca3c0f44b2c55246">send_serial</a> (uint8_t *data, uint8_t length, char *cmd_reply, uint32_t rx_wait)</td></tr>
<tr class="memdesc:a14a3978f311f3f3fca3c0f44b2c55246"><td class="mdescLeft">&#160;</td><td class="mdescRight">sends raw serial data to the SIM808 module through the AT_uart peripheral. Then it deletes the receive buffer.  <a href="#a14a3978f311f3f3fca3c0f44b2c55246">More...</a><br/></td></tr>
<tr class="separator:a14a3978f311f3f3fca3c0f44b2c55246"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7fd99066f679511e6da2daa328738f5"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim808_8c.html#ae7fd99066f679511e6da2daa328738f5">send_cmd</a> (const char *cmd, uint32_t rx_wait)</td></tr>
<tr class="memdesc:ae7fd99066f679511e6da2daa328738f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">sends AT commands to the SIM808 module through the AT_uart peripheral. in case the module replies with an error, or doesn't reply anything, it will try to send the command 2 more times after a timeout period.  <a href="#ae7fd99066f679511e6da2daa328738f5">More...</a><br/></td></tr>
<tr class="separator:ae7fd99066f679511e6da2daa328738f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4e284e16e0b826afe2533546eb423da"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim808_8c.html#ad4e284e16e0b826afe2533546eb423da">sim_get_cmd_reply</a> (const char *cmd, char *cmd_reply, uint32_t rx_wait)</td></tr>
<tr class="memdesc:ad4e284e16e0b826afe2533546eb423da"><td class="mdescLeft">&#160;</td><td class="mdescRight">sends a cmd to the module and copies the reply into the parameter char * cmd_reply  <a href="#ad4e284e16e0b826afe2533546eb423da">More...</a><br/></td></tr>
<tr class="separator:ad4e284e16e0b826afe2533546eb423da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae494a9643f29b87d6d81e5264e60e57b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim808_8c.html#ae494a9643f29b87d6d81e5264e60e57b">HAL_UART_RxCpltCallback</a> (UART_HandleTypeDef *huart)</td></tr>
<tr class="memdesc:ae494a9643f29b87d6d81e5264e60e57b"><td class="mdescLeft">&#160;</td><td class="mdescRight">is called when the receive buffer of any UART has received 1 byte. it copies the received byte into the receive buffer which is a global variable: sim_rx_buffer. it also increases by one the counter of received bytes: rx_index. Which points to the next free index in the receive buffer. usart1 is always used to communicate with SIM module therefore AT_uart is defined as usart1.  <a href="#ae494a9643f29b87d6d81e5264e60e57b">More...</a><br/></td></tr>
<tr class="separator:ae494a9643f29b87d6d81e5264e60e57b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2605f3426f7113811f78dd74ec94b36f"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim808_8c.html#a2605f3426f7113811f78dd74ec94b36f">sim_init</a> (<a class="el" href="structSIM808__typedef.html">SIM808_typedef</a> *sim)</td></tr>
<tr class="memdesc:a2605f3426f7113811f78dd74ec94b36f"><td class="mdescLeft">&#160;</td><td class="mdescRight">it initialises the <a class="el" href="structSIM808__typedef.html" title="is used to abstract the SIM808 hardware interface. It will decouple the functions from the hardware (...">SIM808_typedef</a> struct members and powers on the module. initializes the UARTs and the GPIOs used to power on, reset and check the status of the module. Which UART peripheral is used for what is specified in the parameter <a class="el" href="structSIM808__typedef.html" title="is used to abstract the SIM808 hardware interface. It will decouple the functions from the hardware (...">SIM808_typedef</a> members: AT_uart and debug_uart.  <a href="#a2605f3426f7113811f78dd74ec94b36f">More...</a><br/></td></tr>
<tr class="separator:a2605f3426f7113811f78dd74ec94b36f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a2cf715bef37f7e8ef385a30974a5f0d5"><td class="memItemLeft" align="right" valign="top">UART_HandleTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim808_8c.html#a2cf715bef37f7e8ef385a30974a5f0d5">huart1</a></td></tr>
<tr class="separator:a2cf715bef37f7e8ef385a30974a5f0d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9479c261d65eecedd3d9582f7f0f89c"><td class="memItemLeft" align="right" valign="top">UART_HandleTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim808_8c.html#aa9479c261d65eecedd3d9582f7f0f89c">huart2</a></td></tr>
<tr class="separator:aa9479c261d65eecedd3d9582f7f0f89c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementations of functions that communicate directly with the SIM808 module and control it. </p>
<dl class="section author"><dt>Author</dt><dd>Mohamed Boubaker </dd></dl>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000001">Bug:</a></b></dt><dd>issue #9 </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a84820ae6c2b7143c1692312a0e3d7069"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AT_uart&#160;&#160;&#160;<a class="el" href="sim808_8c.html#a2cf715bef37f7e8ef385a30974a5f0d5">huart1</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a2e23ff1d2d0704f67d286589f8de591a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define debug_uart&#160;&#160;&#160;<a class="el" href="sim808_8c.html#aa9479c261d65eecedd3d9582f7f0f89c">huart2</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ae494a9643f29b87d6d81e5264e60e57b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void HAL_UART_RxCpltCallback </td>
          <td>(</td>
          <td class="paramtype">UART_HandleTypeDef *&#160;</td>
          <td class="paramname"><em>huart</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>is called when the receive buffer of any UART has received 1 byte. it copies the received byte into the receive buffer which is a global variable: sim_rx_buffer. it also increases by one the counter of received bytes: rx_index. Which points to the next free index in the receive buffer. usart1 is always used to communicate with SIM module therefore AT_uart is defined as usart1. </p>

</div>
</div>
<a class="anchor" id="ae7fd99066f679511e6da2daa328738f5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t send_cmd </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>rx_wait</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>sends AT commands to the SIM808 module through the AT_uart peripheral. in case the module replies with an error, or doesn't reply anything, it will try to send the command 2 more times after a timeout period. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cmd</td><td>contains the command </td></tr>
    <tr><td class="paramname">rx_wait</td><td>waiting time before checking the receive buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>SUCCESS if the module replies with OK, FAIL otherwise </dd></dl>

</div>
</div>
<a class="anchor" id="a6e14828149893fb70f1cee3155436042"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void send_debug </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>debug_msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a14a3978f311f3f3fca3c0f44b2c55246"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void send_serial </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>cmd_reply</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>rx_wait</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>sends raw serial data to the SIM808 module through the AT_uart peripheral. Then it deletes the receive buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cmd</td><td>contains the command </td></tr>
    <tr><td class="paramname">rx_wait</td><td>waiting time before exit. To make sure the reply is received. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ad4e284e16e0b826afe2533546eb423da"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t sim_get_cmd_reply </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>cmd_reply</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>rx_wait</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>sends a cmd to the module and copies the reply into the parameter char * cmd_reply </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cmd</td><td>is the command </td></tr>
    <tr><td class="paramname">cmd_reply</td><td>is an array where to modules reply will be copied. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>SUCCESS if the module replies with OK, FAIL otherwise </dd></dl>

</div>
</div>
<a class="anchor" id="a2605f3426f7113811f78dd74ec94b36f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t sim_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSIM808__typedef.html">SIM808_typedef</a> *&#160;</td>
          <td class="paramname"><em>sim</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>it initialises the <a class="el" href="structSIM808__typedef.html" title="is used to abstract the SIM808 hardware interface. It will decouple the functions from the hardware (...">SIM808_typedef</a> struct members and powers on the module. initializes the UARTs and the GPIOs used to power on, reset and check the status of the module. Which UART peripheral is used for what is specified in the parameter <a class="el" href="structSIM808__typedef.html" title="is used to abstract the SIM808 hardware interface. It will decouple the functions from the hardware (...">SIM808_typedef</a> members: AT_uart and debug_uart. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sim</td><td>is the definition of the sim808 hardware </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>SUCCESS if module is ready for use, FAIL otherwise </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a2cf715bef37f7e8ef385a30974a5f0d5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UART_HandleTypeDef huart1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="aa9479c261d65eecedd3d9582f7f0f89c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UART_HandleTypeDef huart2</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
